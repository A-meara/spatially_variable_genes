Bootstrap: localimage
From: python_base_ob.sif

%post
    # Install system dependencies
    apt-get update && apt-get install -y \
        git \
        procps \
        libhdf5-dev \
        cmake \
        gdal-bin \
        libgdal-dev

    # Install base Python packages first (Python 3.12 compatible versions)
    pip install --no-cache-dir --break-system-packages \
        Cython \
        numpy \
        scipy

    # Clone scGCO
    git clone https://github.com/lzj1769/scGCO_simple.git /opt/scGCO/scGCO_simple

    # Install remaining Python packages (remove version pins for Python 3.12 compatibility)
    pip install --no-cache-dir --break-system-packages \
        h5py \
        pandas \
        parmap \
        scanpy \
        tqdm \
        matplotlib \
        scikit-learn \
        hdbscan \
        seaborn \
        pysal \
        pygco \
        shapely \
        networkx \
        scikit-image \
        pyyaml \
        requests

    # Clean up
    apt-get clean
    rm -rf /var/lib/apt/lists/*

%labels
    Author "OpenProblems/Aidan Meara"
    Version "1.0.0"
    Description "scGCO method for spatially variable gene detection"
    BaseImage "python_base_ob.sif (Python 3.12)"
