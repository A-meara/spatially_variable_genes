Bootstrap: docker
From: python:3.9.16

%post
    # Install system dependencies
    apt-get update && apt-get install -y \
        git \
        procps \
        libhdf5-dev \
        cmake \
        gdal-bin \
        libgdal-dev

    # Install base Python packages first
    pip install --no-cache-dir \
        Cython==0.29.33 \
        numpy==1.23.5 \
        scipy==1.9.1

    # Clone scGCO
    git clone https://github.com/lzj1769/scGCO_simple.git /opt/scGCO/scGCO_simple

    # Install remaining Python packages
    pip install --no-cache-dir \
        h5py==3.8.0 \
        pandas==1.5.3 \
        parmap==1.6.0 \
        scanpy==1.9.3 \
        tqdm==4.65.0 \
        anndata==0.8.0 \
        matplotlib==3.7.1 \
        scikit-learn==1.2.2 \
        hdbscan \
        seaborn==0.12.2 \
        pysal==2.0.0 \
        pygco==0.0.16 \
        shapely==2.0.1 \
        networkx==2.5 \
        scikit-image \
        pyyaml \
        requests

    # Clean up
    apt-get clean
    rm -rf /var/lib/apt/lists/*

%labels
    Author OpenProblems/Aidan Meara
    Version 1.0.0

%help
    scGCO method for spatially variable gene detection
    Based on python:3.9.16
